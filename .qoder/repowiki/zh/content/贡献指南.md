# 贡献指南

<cite>
**本文档中引用的文件**  
- [CONTRIBUTING.md](file://CONTRIBUTING.md)
- [README.md](file://README.md)
- [app/pubspec.yaml](file://app/pubspec.yaml)
- [app/analysis_options.yaml](file://app/analysis_options.yaml)
- [app/rust/Cargo.toml](file://app/rust/Cargo.toml)
- [common/analysis_options.yaml](file://common/analysis_options.yaml)
- [cli/analysis_options.yaml](file://cli/analysis_options.yaml)
- [app/test/unit/i18n_test.dart](file://app/test/unit/i18n_test.dart)
- [app/test/mocks.dart](file://app/test/mocks.dart)
- [app/rust_builder/pubspec.yaml](file://app/rust_builder/pubspec.yaml)
- [app/rust_builder/README.md](file://app/rust_builder/README.md)
</cite>

## 目录
1. [代码规范和风格指南](#代码规范和风格指南)
2. [问题报告流程](#问题报告流程)
3. [代码提交流程](#代码提交流程)
4. [代码审查指南](#代码审查指南)
5. [文档更新要求](#文档更新要求)
6. [本地开发环境设置和测试执行](#本地开发环境设置和测试执行)
7. [入门任务建议和学习路径](#入门任务建议和学习路径)
8. [社区行为准则和协作原则](#社区行为准则和协作原则)

## 代码规范和风格指南

LocalSend 项目遵循严格的代码规范和风格指南，以确保代码库的一致性和可维护性。项目主要使用 Dart 和 Rust 两种编程语言，每种语言都有其特定的编码标准。

对于 Dart 代码，项目遵循 [Dart 风格指南](https://dart.dev/guides/language/effective-dart/style)，并使用 `flutter_lints` 包来强制执行最佳实践。在 `app/analysis_options.yaml` 文件中，配置了包括 `prefer_single_quotes`、`sort_pub_dependencies`、`always_use_package_imports` 和 `directives_ordering` 在内的多项 lint 规则，以确保代码风格的统一。此外，`common` 和 `cli` 目录下的 `analysis_options.yaml` 文件也包含了类似的配置，确保整个项目的一致性。

对于 Rust 代码，项目在 `app/rust/Cargo.toml` 文件中定义了依赖项和构建配置。Rust 代码主要用于核心功能的实现，并通过 `flutter_rust_bridge` 与 Dart 代码进行交互。项目使用 `anyhow`、`bytes`、`tokio`、`tracing` 等流行的 Rust 库来处理错误、异步操作和日志记录。

命名约定方面，Dart 代码遵循驼峰命名法（camelCase）用于变量和函数，大驼峰命名法（PascalCase）用于类和类型。Rust 代码则遵循 Rust 社区的标准，使用蛇形命名法（snake_case）用于函数和变量，大驼峰命名法用于结构体和枚举。

代码格式化方面，项目使用 `build_runner` 和 `slang_build_runner` 等工具来自动生成代码和处理国际化字符串。开发者在提交代码前应确保运行 `flutter pub run build_runner build -d` 来生成必要的代码文件。

**Section sources**
- [CONTRIBUTING.md](file://CONTRIBUTING.md#L39-L56)
- [app/analysis_options.yaml](file://app/analysis_options.yaml#L0-L29)
- [common/analysis_options.yaml](file://common/analysis_options.yaml#L0-L9)
- [cli/analysis_options.yaml](file://cli/analysis_options.yaml#L0-L9)
- [app/rust/Cargo.toml](file://app/rust/Cargo.toml#L0-L17)

## 问题报告流程

当您在使用 LocalSend 时遇到问题或有功能请求时，可以通过以下流程提交问题报告。

首先，对于普通的 bug 报告或功能请求，请在项目的 [问题跟踪器](https://github.com/localsend/localsend/issues) 中提交一个新的 issue。在提交 issue 时，请确保提供清晰的问题描述，包括问题的具体表现、复现步骤、预期行为和实际行为。如果可能，请附上相关的日志信息或截图，以便开发团队能够更快地定位和解决问题。

对于安全问题，由于其敏感性，**请不要**在公共的问题跟踪器中提交。相反，请直接通过电子邮件联系项目维护者：[support@localsend.org](mailto:support@localsend.org)。这样可以确保安全问题得到及时和保密的处理，避免在问题修复前被公开披露。

在提交问题报告时，建议先搜索已有的 issue，以避免重复报告相同的问题。如果发现已有类似的问题，可以在该 issue 下添加您的信息或复现步骤，以帮助开发团队更好地理解问题的影响范围。

**Section sources**
- [CONTRIBUTING.md](file://CONTRIBUTING.md#L58-L67)
- [README.md](file://README.md#L200-L205)

## 代码提交流程

贡献代码到 LocalSend 项目需要遵循一个明确的流程，以确保代码质量和项目稳定性。

首先，从 `main` 分支创建一个新的功能分支。这个分支应该有一个描述性的名称，例如 `feature/add-new-ui` 或 `bugfix/fix-crash-on-startup`。在分支上进行代码修改时，应确保遵循项目的代码规范和风格指南。

完成代码修改后，需要运行测试以确保更改不会引入新的问题。项目要求所有更改都应有相应的测试覆盖。可以使用 `flutter test` 命令来运行单元测试，确保所有测试都通过。

在提交代码之前，应使用 `flutter pub run build_runner build -d` 命令生成必要的代码文件，并使用 `flutter analyze` 检查代码是否符合 lint 规则。确保没有编译错误或 lint 警告。

最后，将更改推送到您的 fork 仓库，并从该分支创建一个拉取请求（Pull Request），目标为 `main` 分支。在拉取请求的描述中，应提供清晰的更改摘要，包括更改的目的、实现方式和任何相关的上下文信息。

**Section sources**
- [CONTRIBUTING.md](file://CONTRIBUTING.md#L42-L49)
- [README.md](file://README.md#L210-L215)

## 代码审查指南

代码审查是确保代码质量和项目健康的重要环节。当您提交拉取请求后，项目维护者和其他贡献者将对您的代码进行审查。

审查标准主要包括代码是否符合项目的风格指南、是否有适当的文档和注释、是否包含足够的测试覆盖、以及是否解决了预期的问题或实现了预期的功能。审查者可能会提出改进建议或要求进行修改。

在审查他人的代码时，应保持尊重和建设性的态度。提供具体的反馈，指出问题所在，并尽可能提供改进建议。避免使用模糊或负面的语言，而是专注于代码本身的技术细节。

期望的反馈方式是通过拉取请求的评论功能进行。审查者可以在具体的代码行上添加评论，指出需要改进的地方。贡献者应积极回应这些评论，进行必要的修改，并在完成修改后通知审查者。

**Section sources**
- [CONTRIBUTING.md](file://CONTRIBUTING.md#L42-L49)

## 文档更新要求

当代码发生变更时，相关的文档也应同步更新，以确保文档的准确性和完整性。

如果您的更改影响了用户界面或功能，应更新 `README.md` 文件中的相关部分。例如，如果添加了新功能，应在 "Getting Started" 或 "How It Works" 部分添加相应的说明。

对于 API 或内部实现的更改，应在相关的代码注释中进行详细说明。使用 Dart 的文档注释（`///`）来描述类、方法和参数的用途和行为。

此外，如果更改涉及国际化字符串，应确保在 `app/assets/i18n` 目录下的相应语言文件中更新或添加翻译。对于新添加的字符串，应先在 `_missing_translations_<locale>.json` 文件中添加占位符，然后通过 `flutter pub run slang` 命令生成相应的 Dart 代码。

**Section sources**
- [CONTRIBUTING.md](file://CONTRIBUTING.md#L7-L37)
- [README.md](file://README.md#L1-L275)

## 本地开发环境设置和测试执行

为了开始贡献代码，您需要设置本地开发环境并能够运行和测试应用程序。

首先，安装 [Flutter](https://flutter.dev) 开发环境。项目使用特定版本的 Flutter，具体版本号可以在 `.fvmrc` 文件中找到。建议使用 [fvm](https://fvm.app) 来管理 Flutter 版本，以确保与项目要求的版本一致。

接下来，安装 [Rust](https://www.rust-lang.org/tools/install) 编程语言，因为项目的核心功能是用 Rust 实现的。

克隆 `LocalSend` 仓库后，进入 `app` 目录并运行以下命令来获取依赖项：

```shell
cd app
flutter pub get
flutter pub run build_runner build -d
```

然后，可以使用 `flutter run` 命令来启动应用程序。对于测试，可以使用 `flutter test` 命令来运行单元测试。项目中的测试文件位于 `app/test` 目录下，包括单元测试和模拟对象的定义。

**Section sources**
- [CONTRIBUTING.md](file://CONTRIBUTING.md#L23-L35)
- [README.md](file://README.md#L220-L230)
- [app/test/unit/i18n_test.dart](file://app/test/unit/i18n_test.dart#L0-L19)
- [app/test/mocks.dart](file://app/test/mocks.dart#L0-L9)

## 入门任务建议和学习路径

对于新贡献者，建议从一些简单的任务开始，逐步熟悉项目的代码库和开发流程。

一个理想的入门任务是参与翻译工作。您可以帮助将应用程序翻译成其他语言。这不仅有助于提高项目的国际化程度，还能让您熟悉项目的文件结构和工作流程。要参与翻译，请查看 `app/assets/i18n` 目录下的 JSON 文件，并根据需要添加或更新翻译。

另一个简单的任务是修复文档中的拼写错误或语法错误。`README.md` 和 `CONTRIBUTING.md` 文件是很好的起点。通过这些小的贡献，您可以了解如何提交拉取请求和参与代码审查。

随着对项目越来越熟悉，可以尝试解决标记为 "good first issue" 的问题。这些问题通常比较独立，适合新贡献者尝试。

学习路径建议：首先阅读 `README.md` 和 `CONTRIBUTING.md` 文件，了解项目的基本信息和贡献指南。然后，尝试运行应用程序并探索其功能。接着，查看 `lib` 目录下的 Dart 代码和 `rust` 目录下的 Rust 代码，了解项目的架构和实现细节。

**Section sources**
- [CONTRIBUTING.md](file://CONTRIBUTING.md#L7-L37)
- [README.md](file://README.md#L1-L275)

## 社区行为准则和协作原则

LocalSend 项目致力于创建一个友好、包容和尊重的社区环境。所有参与者都应遵守基本的社区行为准则。

在与他人互动时，应保持礼貌和尊重，避免使用攻击性或贬低性的语言。讨论应集中在技术问题上，而不是个人。如果出现分歧，应通过建设性的对话来解决，寻求共识。

协作原则包括：在提出重大更改或新功能之前，先创建 issue 进行讨论，以确保更改符合项目的方向和需求。对于 bug 修复，可以直接创建拉取请求，但应提供清晰的问题描述和解决方案说明。

项目维护者有责任及时回应贡献者的拉取请求和问题报告，并提供有帮助的反馈。同时，贡献者也应积极回应审查意见，进行必要的修改。

通过遵循这些准则和原则，我们可以共同维护一个健康、活跃和富有成效的开源社区。

**Section sources**
- [CONTRIBUTING.md](file://CONTRIBUTING.md#L7-L67)
- [README.md](file://README.md#L1-L275)