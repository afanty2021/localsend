# 快速开始

<cite>
**本文档中引用的文件**
- [README.md](file://README.md)
- [app/pubspec.yaml](file://app/pubspec.yaml)
- [app/rust/Cargo.toml](file://app/rust/Cargo.toml)
- [app/rust-toolchain.toml](file://app/rust-toolchain.toml)
- [CONTRIBUTING.md](file://CONTRIBUTING.md)
- [app/flutter_rust_bridge.yaml](file://app/flutter_rust_bridge.yaml)
- [app/rust_builder/pubspec.yaml](file://app/rust_builder/pubspec.yaml)
- [scripts/compile_android_apk.sh](file://scripts/compile_android_apk.sh)
- [scripts/compile_ios.sh](file://scripts/compile_ios.sh)
- [scripts/compile_windows_exe.ps1](file://scripts/compile_windows_exe.ps1)
- [scripts/compile_linux_appimage.sh](file://scripts/compile_linux_appimage.sh)
</cite>

## 目录
1. [简介](#简介)
2. [环境准备](#环境准备)
3. [构建与运行](#构建与运行)
4. [用户使用指南](#用户使用指南)
5. [开发者开发环境设置](#开发者开发环境设置)
6. [常见问题解决方案](#常见问题解决方案)
7. [使用示例](#使用示例)

## 简介

LocalSend 是一个免费的开源应用程序，允许您在本地网络中安全地与附近设备共享文件和消息，而无需互联网连接。该项目采用 Flutter 和 Rust 技术栈，通过 Flutter-Rust 桥接实现高性能的本地网络通信功能。

**Section sources**
- [README.md](file://README.md#L1-L275)

## 环境准备

### Flutter SDK 安装

LocalSend 项目需要特定版本的 Flutter SDK。根据项目配置，推荐使用 fvm (Flutter Version Manager) 来管理 Flutter 版本，以确保开发环境的一致性。

1. 安装 fvm：
```bash
dart pub global activate fvm
```

2. 在项目根目录下安装指定版本的 Flutter：
```bash
fvm install
```

3. 设置项目使用的 Flutter 版本：
```bash
fvm use
```

项目使用的 Flutter 版本在 `.fvmrc` 文件中指定，当前要求 Flutter 版本为 3.25.0。

**Section sources**
- [README.md](file://README.md#L220-L234)
- [CONTRIBUTING.md](file://CONTRIBUTING.md#L10-L15)

### Rust 工具链安装

LocalSend 使用 Rust 作为后端逻辑的实现语言，需要安装 Rust 工具链。

1. 安装 Rust：
```bash
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
```

2. 根据项目配置设置 Rust 工具链版本：
```bash
rustup override set 1.84.1
```

项目在 `app/rust-toolchain.toml` 文件中指定了所需的 Rust 版本为 1.84.1，并预配置了针对 Android、iOS 和 macOS 的交叉编译目标。

**Section sources**
- [README.md](file://README.md#L220-L234)
- [app/rust-toolchain.toml](file://app/rust-toolchain.toml#L1-L4)

### Flutter-Rust 桥接配置

LocalSend 使用 flutter_rust_bridge 实现 Flutter 与 Rust 之间的通信。

1. 项目中已配置好桥接：
- `app/flutter_rust_bridge.yaml` 文件定义了桥接配置
- Rust 输入路径为 `crate::api`
- Dart 输出路径为 `lib/rust`

2. 依赖配置：
- 在 `app/pubspec.yaml` 中声明了 `flutter_rust_bridge: 2.11.1` 依赖
- 在 `app/rust/Cargo.toml` 中声明了对应的 Rust 依赖

桥接机制允许 Dart 代码调用 Rust 函数，实现高性能的网络通信和文件传输功能。

**Section sources**
- [app/flutter_rust_bridge.yaml](file://app/flutter_rust_bridge.yaml#L1-L4)
- [app/pubspec.yaml](file://app/pubspec.yaml#L35-L36)
- [app/rust/Cargo.toml](file://app/rust/Cargo.toml#L10-L11)

## 构建与运行

### Android 平台

构建 Android 应用程序有两种方式：APK 和 App Bundle。

1. 构建 APK：
```bash
flutter build apk
```

2. 构建 App Bundle（用于 Google Play）：
```bash
flutter build appbundle
```

项目提供了自动化脚本 `scripts/compile_android_apk.sh`，该脚本遵循 F-Droid 的可重现构建标准，确保构建过程的一致性和可验证性。

**Section sources**
- [README.md](file://README.md#L250-L255)
- [scripts/compile_android_apk.sh](file://scripts/compile_android_apk.sh#L1-L32)

### iOS 平台

构建 iOS 应用程序需要使用 Xcode 工具链。

1. 构建 IPA：
```bash
flutter build ipa
```

2. 构建脚本 `scripts/compile_ios.sh` 提供了完整的构建流程，包括清理、获取依赖、预缓存 iOS 组件和构建 IPA。

**Section sources**
- [README.md](file://README.md#L257-L259)
- [scripts/compile_ios.sh](file://scripts/compile_ios.sh#L1-L14)

### Windows 平台

Windows 平台支持多种分发格式。

1. 构建传统可执行文件：
```bash
flutter build windows
```

2. 创建 MSIX 安装包：
```bash
flutter pub run msix:create
```

3. 创建适用于商店的 MSIX：
```bash
flutter pub run msix:create --store
```

项目提供了 PowerShell 脚本 `scripts/compile_windows_exe.ps1` 来创建 Inno Setup 安装程序。

**Section sources**
- [README.md](file://README.md#L267-L275)
- [scripts/compile_windows_exe.ps1](file://scripts/compile_windows_exe.ps1#L1-L20)

### macOS 平台

构建 macOS 应用程序：

```bash
flutter build macos
```

构建的 macOS 应用程序兼容 macOS 11 Big Sur 及更高版本。

**Section sources**
- [README.md](file://README.md#L261-L263)

### Linux 平台

Linux 平台支持多种打包格式。

1. 构建传统二进制文件：
```bash
flutter build linux
```

2. 创建 AppImage：
```bash
appimage-builder --recipe AppImageBuilder.yml
```

3. 其他格式包括 Snap、DEB、TAR 和 AUR 包。

项目提供了脚本 `scripts/compile_linux_appimage.sh` 来构建 AppImage 格式。

**Section sources**
- [README.md](file://README.md#L277-L285)
- [scripts/compile_linux_appimage.sh](file://scripts/compile_linux_appimage.sh#L1-L40)

## 用户使用指南

### 应用程序安装

用户可以从多种渠道安装 LocalSend 应用程序：

- **Windows**: 可通过 Winget、Scoop、Chocolatey 或直接下载 EXE 安装程序
- **macOS**: 可通过 App Store、Homebrew 或下载 DMG 安装程序
- **Linux**: 可通过 Flathub、Nixpkgs、Snap 或 AUR 安装
- **Android**: 可通过 Google Play Store 或 F-Droid 安装
- **iOS**: 可通过 App Store 安装

推荐从官方应用商店或包管理器下载应用程序，因为应用程序没有自动更新功能。

**Section sources**
- [README.md](file://README.md#L108-L145)

### 基本使用方法

#### 发送文件

1. 打开 LocalSend 应用程序
2. 选择"发送"模式
3. 选择要发送的文件
4. 应用程序会自动发现同一网络中的其他设备
5. 选择目标设备
6. 确认接收方接受文件传输

#### 接收文件

1. 打开 LocalSend 应用程序
2. 选择"接收"模式
3. 应用程序会显示一个二维码
4. 发送方扫描此二维码或选择此设备
5. 当有文件发送请求时，会显示通知
6. 接收方确认接受文件

所有数据通过 HTTPS 加密传输，TLS/SSL 证书在每个设备上动态生成，确保最大安全性。

**Section sources**
- [README.md](file://README.md#L188-L200)

## 开发者开发环境设置

### 代码克隆

1. 克隆项目仓库：
```bash
git clone https://github.com/localsend/localsend.git
cd localsend
```

2. 初始化子模块：
```bash
git submodule update --init
```

### 依赖安装

1. 进入 app 目录：
```bash
cd app
```

2. 获取 Flutter 依赖：
```bash
flutter pub get
```

3. 生成代码：
```bash
flutter pub run build_runner build -d
```

项目依赖管理通过 pubspec.yaml 文件进行，包括 UI 组件、网络通信、文件选择等各类插件。

**Section sources**
- [CONTRIBUTING.md](file://CONTRIBUTING.md#L10-L18)
- [app/pubspec.yaml](file://app/pubspec.yaml#L1-L124)

### 调试运行

启动应用程序进行调试：

```bash
flutter run
```

使用 fvm 可以确保使用正确的 Flutter 版本：

```bash
fvm flutter run
```

应用程序支持在多种设备上运行，包括移动设备和桌面设备。

**Section sources**
- [CONTRIBUTING.md](file://CONTRIBUTING.md#L10-L18)

## 常见问题解决方案

### 构建失败

1. **Flutter 版本不匹配**：使用 fvm 确保使用正确的 Flutter 版本
2. **Rust 工具链问题**：确保安装了正确版本的 Rust 和必要的目标平台
3. **依赖下载失败**：检查网络连接，特别是对于需要访问外部仓库的依赖

### 平台特定错误

| 问题 | 解决方案 |
|------|---------|
| 设备不可见 | 确保路由器上的 AP 隔离已禁用 |
| Windows 上设备不可见 | 将网络配置为"专用"网络 |
| macOS/iOS 上设备不可见 | 检查"隐私"设置中的"本地网络"权限 |
| 传输速度慢 | 使用 5GHz 网络；在两台设备上禁用加密 |

**Section sources**
- [README.md](file://README.md#L202-L217)

## 使用示例

### 两设备间文件传输流程

1. **环境准备**：
   - 确保两台设备连接到同一局域网
   - 在两台设备上安装 LocalSend 应用程序

2. **发送方操作**：
   - 打开 LocalSend 应用程序
   - 选择"发送"模式
   - 选择要发送的文件（支持多种文件类型）
   - 等待设备发现过程完成

3. **接收方操作**：
   - 打开 LocalSend 应用程序
   - 选择"接收"模式
   - 应用程序会显示设备名称和二维码

4. **建立连接**：
   - 发送方在设备列表中看到接收方设备
   - 发送方选择接收方设备
   - 接收方收到传输请求通知

5. **文件传输**：
   - 接收方确认接受文件
   - 显示传输进度
   - 传输完成后，文件保存到接收方设备

6. **验证结果**：
   - 检查文件完整性
   - 确认文件大小和内容正确

此流程展示了 LocalSend 的核心功能，即在无需互联网连接的情况下，在本地网络中的设备间安全地传输文件。

**Section sources**
- [README.md](file://README.md#L188-L200)